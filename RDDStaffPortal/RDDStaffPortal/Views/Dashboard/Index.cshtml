
@{
    ViewBag.Title = "Department Master";
    Layout = "~/Views/Shared/_CommonLayout.cshtml";
}

<script src="~/Scripts/Application/Dashboardjs.js"></script>
<div class="main-panel">
    <div class="container">

        <div class="page-inner">
            <div class="loader1"></div>
            <div class="rowmin row allwidgets">

                <div class="col-12 col-md-9 padd-0">
                    <div class="leftwidgets">
                        @{ Html.RenderAction("GetDashBoardView", "Account");}
                    </div>
                </div>

                <div class="col-6 col-md-3">
                    <div class="rightwidgets">
                        <div class="row rights1">
                            @{ Html.RenderAction("GetRightSide", "Dashboard");}

                        </div>
                       
                        <div class="row rights2">
                            @{ Html.RenderAction("GetRightSideTask", "Dashboard");}
                            <div>
                            </div>
                        </div>

                    </div>
        </div>
    </div>
</div>
<div id="NotifyModal"></div>

<div  class="modal fade" role="dialog">
    <div class="modal-dialog">
        <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-header  alert alert-danger">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title">Welcome</h4>
            </div>
            <div class="modal-body">
                <p>
                    <div id="myModal" class="modal fade" role="dialog">
                        <div class="modal-dialog">
                            <!-- Modal content-->
                            <div class="modal-content">
                                <div class="modal-header">
                                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                                    <h4 class="modal-title">Modal Header</h4>
                                </div>
                                <div class="modal-body">
                <p>Some text in the modal.</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            </div>
        </div>

    </div>
</div></p>
      </div>
<div class="modal-footer">
    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
</div>
    </div>

  </div>
</div>

<!-- Modal -->
<div class="modal fade" id="SelectWidgetspopup" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true" keyboard="false" data-backdrop="static">
    <div class="modal-dialog modal-80per modal-dialog-centered " role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLongTitle">Select Widgets</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body selectwidget-section">
                <div class="demo-scrollbar scrollbar-inner" style="max-height: 300px">
                    @{ Html.RenderAction("GetUserWidget", "UserRights", new { area = "Admin" }); }
                </div>




            </div>
            <div class="modal-footer">
                <button id="btnsave" type="button" class="btn btn-success btn-sm">Save</button>
                <button type="button" class="btn btn-danger btn-sm" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>
<!-- Modal -->
<div class="modal fade" id="NewTaskWidgetspopup" tabindex="-1" role="dialog" aria-labelledby="NewTaskWidgetspopup" aria-hidden="true" keyboard="false" data-backdrop="static">
    <div class="modal-dialog modal-80per modal-dialog-centered " role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLongTitle">New Task</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body selectwidget-section">





            </div>
            <div class="modal-footer">
                <button id="btnsave1" type="button" class="btn btn-success btn-sm">Save</button>
                <button type="button" class="btn btn-danger btn-sm" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>


<div class="modal fade" id="NewApprovalRequestWidgetspopup" tabindex="-1" role="dialog" aria-labelledby="NewApprovalRequestWidgetspopup" aria-hidden="true" keyboard="false" data-backdrop="static">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Requests</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body px-1 pb-1">
                <table class="table">
                    <thead>
                        <tr>
                            <th style="width:20px" scope="col">#</th>
                            <th scope="col" style="width: 203px">Approval Request</th>

                            <th style="text-align: right;" scope="col">Action</th>
                        </tr>
                    </thead>
                    <tbody id="ApprovalRequest_Body_Ibody">
                        <tr id="ApprovalRequest_Body_Ist">
                            <th scope="row" class="Abcd">1</th>
                            <td class="Abcd">PV DU000087 shirin</td>

                            <td style="text-align: right;" class="Abcd"><a class="fa fa-eye fa-2x"></a></td>
                        </tr>

                    </tbody>
                </table>
            </div>
            
        </div>
        @*<div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLongTitle">Approval Request</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body selectwidget-section" >


                <div class="table-responsive">
                    <div class="reddotTable sm-form mar-t0">
                        <div class="loader1"></div>
                        <div id="ApprovalRequest_Body_Ind" class="reddotTableBody">
                            <div class="reddotTableRow odd-even-row">


                                <div class="reddotTableHead"><div> Approval Request</div></div>
                                <div class="reddotTableHead"><div>Action</div></div>


                            </div>
                        </div>
                        <div id="ApprovalRequest_Body_Ibody" class="reddotTableBody">
                            <div id="ApprovalRequest_Body_Ist" class="reddotTableRow odd-even-row">
                                <div class="reddotTableCellLeft  Abcd"><div></div></div>
                                <div class="reddotTableCell Abcd"><div>  <a class="fa fa-eye fa-2x"></a></div></div>


                            </div>

                        </div>
                    </div>

                </div>


            </div>

        </div>*@
    </div>
</div>

@*@{ Html.RenderAction("GetMenuTree", "Account"); }*@
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<style>
    .demo-scrollbar {
        height: 300px;
    }
</style>
<script>
    var data_Notification = '';
    $(document).ready(function () {

        (function ($) {
            $(function () {
                $("#txtsearchId").focus();
                $(":input[type='search']").removeAttr("autocomplete");
                $(":input[type='search']").attr("autocomplete", "off");
                /// $(":input").attr("autocomplete", "nope");

                $(":input[type='search']").attr("autocomplete", "nope");
                $(":input[type='search']").val("");


            });
        })(jQuery);
        $('.scrollbar-inner').scrollbar();

       

      //  $("[id^='NewApprovalRequestbtn']").on("click", function () {
        $(document).on("click", "[id^='NewApprovalRequestbtn']", function () {
            debugger
             $(".loader1").show();
            $.ajax({
                async: false,
                cache: false,
                type: "POST",
                url: '/Dashboard/GetNotificationDashBoard',
                contentType: "application/json",
                dataType: "json",
                success: function (response) {
                    data_Notification = response.Table;
                },
                error: function (error) {
                    data_Notification = '';
                }
            });
            var i = 0;
           
            var Notification_Type = $(this).attr("name");
            if (Notification_Type != undefined) {

                var found_names = data_Notification;
                found_names = $.grep(found_names, function (v) {
                    return v.Notification_Type === Notification_Type;
                });

                $('tbody#ApprovalRequest_Body_Ist').not(':first').remove();
                if (found_names != null && found_names.length != 0) {
                    var i = 0;
                    $("#ApprovalRequest_Body_Ist").show();
                    while (found_names.length > i) {
                        var tr = $("#ApprovalRequest_Body_Ist").clone();
                       
                        var k = 0;
                        var l1 = tr.find(".Abcd").length;
                        while (l1 > k + 1) {
                            tr.find(".Abcd").eq(0).text(i + 1); 
                            tr.find(".Abcd").eq(1).text(found_names[i]["NotificationText"]);
                            tr.find(".fa-eye").attr("href", found_names[i]["Notification_URL"]);
                            k++;
                        }
                        $("#ApprovalRequest_Body_Ibody").append(tr);
                        i++;
                    }
                   $("#ApprovalRequest_Body_Ist")[0].remove();
                } else {

                    $("#ApprovalRequest_Body_Ist").hide();

                }
                $(".loader1").hide();
                $("#NewApprovalRequestWidgetspopup").modal('show');
            }
        })
        $.ajax({
            async: false,
            cache: false,
            type: "POST",
            url: "/GetNotify_message",
            contentType: "Application/json",
            dataType: 'JSON',
            success: function (response) {
                debugger
                //$("#NotifyModal").modal('show');
                var i = 0;
                while (response.data.length > i) {
                    //#region Modal
                    $("#NotifyModal").append('<div id="NotifyModal' + response.data[i].Welcome_id + '" ></div>')
                    
                //#endregion

                    $("#NotifyModal" + response.data[i].Welcome_id).html('<div class="modal fade myModal"  id="Notify' + response.data[i].Welcome_id + '" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" keyboard="false" data-backdrop="static" show="false">' +

                        '<div class="modal-dialog modal-lg">' +
                        '<div class="modal-content" style="border-radius: 20px !important;">' +

                     

                        '<div class="modal-body"  style="background-image: url(data:image;base64,' + response.data[i].Welcome_image1 +'); ' +
                        'background-repeat:no-repeat;background-position:right center; min-height: 400px; border-radius: 20px;">' +

                        '<h1 style="font-weight: bold; color: #d71313;font-size: 3.4em;padding: 10px;width: 540px;font-family: system-ui;line-height: initial;">' + response.data[i].Welcome_title + '</h1>' +
                        '<p style="width: 540px;font-size: 30px; padding: 0 10px;color: black;font-family: system-ui;font-weight: 100;' +
                        'line-height: initial;">' + response.data[i].Welcome_Message + '</p>' +
                        '<p> <i class="fa fa-info-circle" style="margin-left: 10px;" aria-hidden="true"></i> For any suggestion and help reach out to us at <span style="color: #d71313; font-weight: 400; padding: 0 10px;">helpdesk@reddotdistribution.com</span></p>' +

                        '<button type="button" id="btnReminder' + response.data[i].Welcome_id + '" data-dismiss="modal" data-id="' + response.data[i].Welcome_id + '" class="btn btn-info" style="margin-left: 10px; border-radius: 35px;">Remind me later</button>' +
                        '<button type="button" id="btnCancel' + response.data[i].Welcome_id + '" data-dismiss="modal" data-id="' + response.data[i].Welcome_id + '"   class="btn btn-danger" style="margin-left: 10px; border-radius: 35px;" >cancel</button>' +



                        '</div > ' +
                        ' </div > ' +
                        '</div>')
                   
                   // $("#Notify" + response.data[i].Welcome_id).modal('show');
                    i++;

                }
                if (response.data.length == i) {
                    $('.myModal').modal();
                }


            }

        })
        $("[id^='btnCancel']").on("click", function () {
            debugger
            var t = $(this).attr("data-id");
            var rdd = {
                Welcome_Id: $(this).attr("data-id"),
                Reminder:'N',
                Read:'Y'
            };
            $.post("/ReminderActivity", { rdd: rdd }, function (response) {
                //$("#NotifyModal" + t).modal('hide');

            });


        })
        $("[id^='btnReminder']").on("click", function () {
            debugger
            var t = $(this).attr("data-id");

            var rdd = {
                Welcome_Id: $(this).attr("data-id"),
                Reminder: 'Y',
                Read: 'Y'
            };
            $.post("/ReminderActivity", { rdd: rdd }, function (response) {
                //$("#NotifyModal" + t).modal('hide');
            });

        })



    });
</script>
<script type="text/javascript">

    $(function () {
        $("body").on("keyup", function () {

            var value = $("#Search-Forms-QuickLinks").val() == undefined?'':$("#Search-Forms-QuickLinks").val().toLowerCase();
            $("#Forms-1 li").find("a").filter(function () {
                $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
            });
        });
    })


    $(document).ready(function () {

        $(".loader1").show();
        $(".allwidgets").hide();

        $("body").click(function (e) {
            $('.scrollbar-inner').scrollbar();
        });
        //$(function () {

        $("#widgetlist").append('<a class="col-6 col-md-4 p-0" href="#" data-toggle="modal" data-target="#SelectWidgetspopup">'
            + ' <div class="quick-actions-item">'
            + '  <div class="avatar-item bg-danger rounded-circle">'
            + '    <i class="fas fa-table"></i>'
            + ' </div>'
            + '<span class="text">Select Widgets</span>'
            + ' </div ></a>');

        $("#widgetlist").append('<a class="col-6 col-md-4 p-0" href="#" data-toggle="modal" data-target="#NewTaskWidgetspopup">'
            + ' <div class="quick-actions-item">'
            + '  <div class="avatar-item bg-danger rounded-circle">'
            + '    <i class="fas fa-table"></i>'
            + ' </div>'
            + '<span class="text">Create Task</span>'
            + ' </div ></a>');

        $(".edit").attr('title', 'Edit');
        $(".delete").attr('title', 'Delete');





        DashBoard.initialize();
        $(".allwidgets").show();

        $("button[class='swal2-confirm']").on("click", function () {
            debugger
            //location.reload();
            window.location = '/Dashboard/Index';
        });
        $(".loader1").hide();


    });
</script>

<style>
    .Abc {
        display: none !important;
    }
</style>
