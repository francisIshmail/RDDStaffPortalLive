@model RDDStaffPortal.DAL.DataModels.LMS.RDD_HRReport

@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_LMSLayout.cshtml";
}

<div class="p-0 dropdown-header py-3 pt-md-5 pb-md-4 mx-auto">
    <div class="container" style="margin-top: 4%;">
        <div class="row">
            <div class="col-md-2">
                <form>
                    @*<select name="department" class="custom-select">
                <option selected>Country </option>
                <option value="one">India </option>

            </select>*@
                    Country
                    <select name="department" class="form-control" id="ddlCountry">
                        <option value="">--Select--</option>
                    </select>
                </form>
                <input type="hidden" id="HdnCountrcode" />
            </div>
            <div class="col-md-2">
                <form>
                    Department
                    <select name="department" class="form-control" id="ddlDepartment">
                        <option value="">--Select--</option>
                    </select>
                </form>
                <input type="hidden" id="HdnDeptId" />
            </div>


            <div class="col-md-4">
                <form>
                    Employee
                    <select name="Employee" class="form-control" id="ddlEmp">
                        <option value="">--Select--</option>
                    </select>
                    <input type="hidden" id="hdnEmployeeId" />
                </form>
            </div>
            <div class="col-md-2">
                <form>
                    LeaveType
                    <select name="Employee" class="form-control" id="ddlLeavetype">
                        <option value="">--Select--</option>
                    </select>
                    <input type="hidden" id="hdnLeaveTypeId" />
                </form>
            </div>

            @*<div class="col-md-2">
            <form>
                <select name="calendar" class="custom-select">
                    <option selected>Select Month & Year </option>
                    <option value="one">Calendar 1</option>
                    <option value="two">Calendar 2</option>
                    <option value="three">Calendar 3</option>
                </select>
            </form>
        </div>*@
            <div class="col-md-2" style="padding-right: 50px; padding-top: 16px;">
                <div class="nav-masthead"><button type="button" class="btn btn-secondary" id="btnSearchReport">Search Report</button></div>
            </div>
        </div>
    </div>
</div>


<div class="container theme-showcase">

    <div id="holder" class="row">

        <div class="container">

            <div class="card mt-3 mb-3 box-shadow">
                <div class="card-header">
                    @*<div class="lftside-hding">
                        <h5 class="my-0 "><i class="fa fa-user" aria-hidden="true"></i><div id="divname">Employee</div> </h5>
                    </div>*@
                    <div class="rgtside-btn">
                        <div class="nav-masthead">
                            <!-- <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#staticBackdrop">Add Ajustment </button> -->
                            <!-- Button Add Ajustment -->
                            <button type="button" class="btn btn-secondary" id="exporttable">
                                Export Data
                            </button>


                        </div>
                    </div>
                </div>
                <div class="card-body">

                    <div class="table-responsive">
                        <table id="htmltable" class="table">
                            <thead>
                                <tr>
                                    <th>Employee Name</th>
                                    <th>Leave Name</th>
                                    <th>Dept Name</th>
                                    <th>Current Yr Entitlement</th>
                                    <th>Total Taken Leave</th>
                                    <th>Total Pending Leave</th>
                                    <th>Balance Days</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
            </div>  
        </div>
        <div id="edit" class="modal fade" role="dialog">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal">×</button>
                        <h4 class="modal-title">Update Data</h4>
                    </div>
                    <div class="modal-body">
                        <input id="fn" type="text" class="form-control" name="fname" placeholder="Leave Type">
                        <input id="ln" type="text" class="form-control" name="fname" placeholder="No Of Days">
                        <input id="mn" type="text" class="form-control" name="fname" placeholder="Description">
                    </div>
                    <div class="modal-footer">
                        <button type="button" id="up" class="btn btn-warning" data-dismiss="modal">Update</button>
                        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>
        <div id="delete" class="modal fade" role="dialog">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal">×</button>
                        <h4 class="modal-title">Delete Data</h4>
                    </div>
                    <div class="modal-body">
                        <strong>Are you sure you want to delete this data?</strong>
                    </div>
                    <div class="modal-footer">
                        <button type="button" id="del" class="btn btn-danger" data-dismiss="modal">Delete</button>
                        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@*<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>*@
<link href="~/Content/bootstrap.min.css" rel="stylesheet" />
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script src="~/Scripts/bootstrap.min.js"></script>

@*<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>*@
<script src="~/Scripts/RedDotUtility.js"></script>


<script src="https://unpkg.com/feather-icons/dist/feather.min.js"></script>
<script>
    feather.replace()
</script>
<script src="https://res.cloudinary.com/dxfq3iotg/raw/upload/v1569818907/jquery.table2excel.min.js"></script>


<!--  Bootstrap core JavaScript
=================================-->
<script src="https://ajax.googleapis.com/ajax/libs/webfont/1.6.26/webfont.js"></script>
<script>
    WebFont.load({
        google: {
            families: ['PT+Sans:400,400i,700,700i', 'Lato:100,100i,300,300i,400,400i,700,700i,900,900i', 'Open+Sans:300,300i,400,400i,600,600i,700,700i,800,800i']
        }
    });
</script>


<script src="https://res.cloudinary.com/dxfq3iotg/raw/upload/v1569818907/jquery.table2excel.min.js"></script>

<script type="text/javascript">

    var j = $.noConflict();

    j(function () {
        j("#exporttable").click(function (e) {
            var table = j("#htmltable");
            if (table && table.length) {
                j(table).table2excel({
                    exclude: ".noExl",
                    name: "Excel Document Name",
                    filename: "EmployeeReport" + new Date().toISOString().replace(/[\-\:\.]/g, "") + ".xls",
                    fileext: ".xls",
                    exclude_img: true,
                    exclude_links: true,
                    exclude_inputs: true,
                    preserveColors: false
                });
            }
        });
    });
    function GetLeaveTypeList(Countryid) {
         debugger
        j.ajax({
            type: "POST",
            url: '@Url.Action("GetCountryWiseLeaveType", "RDD_HRLMSReport")',
            data: { Cid: Countryid },
            dataType: "json",
            success: function (data) {
                
                var d = data.Table;
                j("#ddlLeavetype").empty();
                j("#ddlLeavetype").append('<option value="-1">--Select--</option>');
                j.each(d, function (index, Value) {
                    j("#ddlLeavetype").append("<option value='" + Value.LeaveTypeId + "'>" + Value.LeaveName + "</option>");
                });
            }
        });
    }
    function GetDropdownList() {
        j.ajax({
            type: "GET",
            url: '@Url.Action("GetDropdownList", "RDD_HRLMSReport")', 
            dataType:"json",
            success: function (data) {
                debugger
                var d = data.Table;
                j("#ddlCountry").empty();
                j("#ddlCountry").append('<option value="-1">--Select--</option>');
                j("#ddlEmp").empty();
                j("#ddlEmp").append('<option value="-1">--Select--</option>');
                j("#ddlDepartment").empty();
                j("#ddlDepartment").append('<option value="-1">--Select--</option>');
                j.each(data.Table, function (index, Value) {
                    j("#ddlCountry").append("<option value='" + Value.CountryCode + "'>" + Value.Country + "</option>");
                });
                j.each(data.Table1, function (index, Value) {
                    j("#ddlEmp").append("<option value='" + Value.EmployeeId + "'>" + Value.FullName + "</option>");
                });
                j.each(data.Table2, function (index, Value) {
                    j("#ddlDepartment").append("<option value='" + Value.DeptId + "'>" + Value.DeptName + "</option>");
                });
            }
        });
    }
    j(document).ready(function () {
        GetDropdownList();
       
    });  
    j(document).on("change", "#ddlCountry", function () {
        debugger
        var Countryid = j(this).val();
        j("#HdnCountrcode").val(Countryid);
        GetLeaveTypeList(Countryid);
    });
    j(document).on('click', '#btnSearchReport', function () {
        var Empid = j("#ddlEmp option:selected").val();
        var CountryId = j("#ddlCountry option:selected").val();
        var Deptid = j("#ddlDepartment option:selected ").val();
        var lvtypeid = j("#ddlLeavetype option:selected").val();
        j.ajax({
            type: "POST",
            url: '@Url.Action("ShowEmployeeReport", "RDD_HRLMSReport")',
            data: { Empid: Empid, Cid: CountryId, DeptId: Deptid, LeaveTypeId: lvtypeid},
            dataType: "json",
            success: function (data) {
                debugger
                var a = data.Table;
               // j("#divname").html(j("#ddlEmp option:selected").text());
                j("#htmltable tbody").empty();
                var i = 0;
                if (a.length > 0) {
                    while (a.length > i) {
                        j("#htmltable tbody").append('<tr><td>' + a[i].FullName + '</td><td>' + a[i].LeaveName + '</td><td>' + a[i].Department + '</td><td>' + a[i].CurrentYearEntitlement + '</td><td>' + a[i].TotalTakenLeave + '</td><td>' + a[i].TotalPendingLeave + '</td><td>' + a[i].BalanceLeave + '</td></tr>');
                        i++;
                    }
                }
                else {
                    j('#htmltable tbody').append('<tr data-no-results-found><td colspan="6">NO RESULTS FOUND</td></tr>');
                    return
                }
               
            }
        });
    });
   
   

</script>

