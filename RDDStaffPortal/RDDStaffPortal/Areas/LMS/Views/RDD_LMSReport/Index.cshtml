@model RDDStaffPortal.DAL.DataModels.LMS.RDD_LMSReport

@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_LMSLayout.cshtml";
}

<div class="p-0 dropdown-header py-3 pt-md-5 pb-md-4 mx-auto">
    <div class="container">
        <div class="row">
            <div class="col-md-2">
                <form>
                    @*<select name="department" class="custom-select">
                            <option selected>Country </option>
                            <option value="one">India </option>

                        </select>*@
                    Country
                    @Html.DropDownListFor(m => m.Country, Model.CountryList, new { @class = "form-control" })
                </form>
            </div>
            <div class="col-md-2">
                <form>
                    Department
                    <select name="department" class="form-control" id="ddlDepartment">
                        <option value="-1">--Select--</option>
                    </select>
                </form>
                <input type="hidden" id="HdnCountryCode" />
            </div>

            <div class="col-md-4">
                <form>
                    Employee
                    <select name="Employee" class="form-control" id="ddlEmp">
                        <option value="-1">--Select--</option>
                    </select>
                    <input type="hidden" id="hdnEmployeeId" />
                </form>
            </div>

            @*<div class="col-md-2">
                    <form>
                        <select name="calendar" class="custom-select">
                            <option selected>Select Month & Year </option>
                            <option value="one">Calendar 1</option>
                            <option value="two">Calendar 2</option>
                            <option value="three">Calendar 3</option>
                        </select>
                    </form>
                </div>*@







            <div class="col-md-2" style="padding-right: 50px; padding-top: 16px;">
                <div class="nav-masthead"><button type="button" class="btn btn-secondary" id="btnSearchReport">Search Report</button></div>
            </div>
        </div>
    </div>
</div>


<div class="container theme-showcase">

    <div id="holder" class="row">

        <div class="container">

            <div class="card mt-3 mb-3 box-shadow">
                <div class="card-header">
                    <div class="lftside-hding">
                        <h5 class="my-0 "><i class="fa fa-user" aria-hidden="true"></i><div id="divname">Employee</div> </h5>
                    </div>
                    <div class="rgtside-btn">
                        <div class="nav-masthead">
                            <!-- <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#staticBackdrop">Add Ajustment </button> -->
                            <!-- Button Add Ajustment -->
                            <button type="button" class="btn btn-secondary" id="exporttable">
                                Export Data
                            </button>


                        </div>
                    </div>
                </div>
                <div class="card-body">

                    <div class="table-responsive">
                        <table id="htmltable" class="table">
                            <thead>
                                <tr>
                                    <th>Leave type</th>
                                    <th>From Date</th>
                                    <th>To Date</th>

                                    <th>No Of Leaves</th>
                                    <th>Reason</th>

                                </tr>
                            </thead>
                            <tbody>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>





        </div>



        <div id="edit" class="modal fade" role="dialog">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal">×</button>
                        <h4 class="modal-title">Update Data</h4>
                    </div>
                    <div class="modal-body">
                        <input id="fn" type="text" class="form-control" name="fname" placeholder="Leave Type">
                        <input id="ln" type="text" class="form-control" name="fname" placeholder="No Of Days">
                        <input id="mn" type="text" class="form-control" name="fname" placeholder="Description">
                    </div>
                    <div class="modal-footer">
                        <button type="button" id="up" class="btn btn-warning" data-dismiss="modal">Update</button>
                        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>
        <div id="delete" class="modal fade" role="dialog">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal">×</button>
                        <h4 class="modal-title">Delete Data</h4>
                    </div>
                    <div class="modal-body">
                        <strong>Are you sure you want to delete this data?</strong>
                    </div>
                    <div class="modal-footer">
                        <button type="button" id="del" class="btn btn-danger" data-dismiss="modal">Delete</button>
                        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>








    </div>
</div>

@*<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>*@
<link href="~/Content/bootstrap.min.css" rel="stylesheet" />
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script src="~/Scripts/bootstrap.min.js"></script>

@*<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>*@
<script src="~/Scripts/RedDotUtility.js"></script>


<script src="https://unpkg.com/feather-icons/dist/feather.min.js"></script>
<script>
    feather.replace()
</script>
<script src="https://res.cloudinary.com/dxfq3iotg/raw/upload/v1569818907/jquery.table2excel.min.js"></script>


<!--  Bootstrap core JavaScript
=================================-->
<script src="https://ajax.googleapis.com/ajax/libs/webfont/1.6.26/webfont.js"></script>
<script>
    WebFont.load({
        google: {
            families: ['PT+Sans:400,400i,700,700i', 'Lato:100,100i,300,300i,400,400i,700,700i,900,900i', 'Open+Sans:300,300i,400,400i,600,600i,700,700i,800,800i']
        }
    });
</script>


<script src="https://res.cloudinary.com/dxfq3iotg/raw/upload/v1569818907/jquery.table2excel.min.js"></script>

<script type="text/javascript">

    var j = $.noConflict();

    j(function () {
        j("#exporttable").click(function (e) {
            var table = j("#htmltable");
            if (table && table.length) {
                j(table).table2excel({
                    exclude: ".noExl",
                    name: "Excel Document Name",
                    filename: "EmployeeReport" + new Date().toISOString().replace(/[\-\:\.]/g, "") + ".xls",
                    fileext: ".xls",
                    exclude_img: true,
                    exclude_links: true,
                    exclude_inputs: true,
                    preserveColors: false
                });
            }
        });
    });

    function GetDeparmentList(Countryid) {
        j.ajax({
            type: "POST",
            url: '@Url.Action("GetCountryWiseDepartment","RDD_LMSReport")',
            data: { Cid: Countryid },
            dataType: "json",
            success: function (data) {
                debugger
                var d = data.Table;
                j("#ddlDepartment").empty();
                j("#ddlDepartment").append('<option value="-1">--Select--</option>');
                j.each(d, function (index, Value) {
                    j("#ddlDepartment").append("<option value='" + Value.DeptId + "'>" + Value.DeptName + "</option>");
                });
            }
        });
    }
    function GetEmployeeList(DeptId,Countryid) {
        j.ajax({
            type: "POST",
            url: '@Url.Action("GetDeptWiseEmployee", "RDD_LMSReport")',
            data: { dept: DeptId, cid:Countryid },
            dataType: "json",
            success: function (data) {
                debugger
                var d = data.Table;
                j("#ddlEmp").empty();
                j("#ddlEmp").append('<option value="-1">--Select--</option>');
                j.each(d, function (index, Value) {
                    j("#ddlEmp").append("<option value='" + Value.EmployeeId + "'>" + Value.FullName + "</option>");
                });
            }
        });
    }


    j(document).on("change", "#Country", function () {
        debugger
        var Countryid = j(this).val();
        j("#HdnCountryCode").val(Countryid);
        GetDeparmentList(Countryid);

    });
    j(document).on("change", "#ddlDepartment", function () {
        var DeptId = j(this).val();
        var Countryid = j("#HdnCountryCode").val();
        GetEmployeeList(DeptId,Countryid);
    });
    j(document).on("change", "#ddlEmp", function () {
        var Empid = j(this).val();
        j("#hdnEmployeeId").val(Empid);
    });
    j(document).on('click', '#btnSearchReport', function () {
        var Empid = j("#hdnEmployeeId").val();
        j.ajax({
            type: "POST",
            url: '@Url.Action("ShowEmployeeReport", "RDD_LMSReport")',
            data: { Empid: Empid},
            dataType: "json",
            success: function (data) {
                debugger
                j("#divname").html(j("#ddlEmp option:selected").text());
                j("#htmltable tbody").empty();
                var i = 0;
                
                while (data.length > i) {
                    if (data[i].AttachmentUrl != "") {
                        j("#htmltable tbody").append('<tr><td>' + data[i].LeaveName + '</td><td>' + RdotdatefrmtRes1(data[i].FromDate) + '</td><td>' + RdotdatefrmtRes1(data[i].ToDate) + '</td><td>' + data[i].NoOfDays + '</td><td>' + data[i].Remarks + '</td><td style="display:none;">' + data[i].LeaveRequestId + '</td><td style="display:none;">' + data[i].LeaveTypeId + '</td><td style="display:none;">' + data[i].EmployeeId + '</td><td>' + '<button id="showLeaveFormpdf">View Leave Form</button >' + '</td><td>' + '<a href="#" target="_blank" id="attachedfile" data="' + data[i].AttachmentUrl + '"><label id="lbldownload">Download Attachment</label></a>' + '</td></tr>');
                        break;
                    }
                    else {
                        while (data.length > i) {
                            j("#htmltable tbody").append('<tr><td>' + data[i].LeaveName + '</td><td>' + RdotdatefrmtRes1(data[i].FromDate) + '</td><td>' + RdotdatefrmtRes1(data[i].ToDate) + '</td><td>' + data[i].NoOfDays + '</td><td>' + data[i].Remarks + '</td><td style="display:none;">' + data[i].LeaveRequestId + '</td><td style="display:none;">' + data[i].LeaveTypeId + '</td><td style="display:none;">' + data[i].EmployeeId + '</td><td>' + '<button id="showLeaveFormpdf">View Leave Form</button >' + '</td></tr>');
                            break;
                        }
                        i++;
                    }
                }               
            }
        });
    });
    j(document).on('click', '#attachedfile', function () {
        var attachment = j(this).attr("data");
        //var attachment = currow.find("td:eq(9)").html();
        if (attachment != "") {
            //$("#lbldownload").show();
            var filepath = attachment;
            var fileNameIndex = filepath.lastIndexOf("/") + 1;
            var filename = filepath.substr(fileNameIndex);
            //$("#lblattachment").text(filename);
            $("#attachedfile").attr('href', filepath);

        }
      
        $("#attachedfile").attr("target", "_blank");
    });
    j(document).on('click', '#showLeaveFormpdf', function () {
        debugger
        var currow = j(this).closest("tr");
        var lvrqid = currow.find("td:eq(5)").html();
        var empid = currow.find("td:eq(7)").html();
        var lvtypeid = currow.find("td:eq(6)").html();
        window.location.href = "/LMS/RDD_LMSReport/GeneratePdfDetails?LeaveRequestId=" + lvrqid + "&EmployeeId=" + empid + "&LeaveTypeId=" + lvtypeid + "";
        @*j.ajax({
            type: "POST",
            url: '@Url.Action("GeneratePdfDetails", "RDD_LMSReport")',
            data: { EmployeeId: empid,LeaveTypeId:lvtypeid,LeaveRequestId:lvrqid },
            dataType: "json",
            success: function (data) {

            }
        });*@     
    });
    
</script>

